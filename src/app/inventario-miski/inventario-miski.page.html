<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/button" text="" color="dark"></ion-back-button>
      <img src="assets/icon/misky.png" alt="Logo MISKY" class="header-logo">
    </ion-buttons>

    <ion-buttons slot="end" class="contenedor-principal">
      <ion-button fill="clear" class="toolbar-btn">
        <img src="assets/icon/Content.svg" alt="Adjuntar" class="toolbar-icon svg-24">
      </ion-button>
      <ion-button fill="clear" class="toolbar-btn">
        <img src="assets/icon/Trailing action 2.svg" alt="Calendario" class="toolbar-icon svg-24">
      </ion-button>
      <ion-button fill="clear" class="toolbar-btn">
        <img src="assets/icon/puntos3.svg" alt="Más opciones" class="toolbar-icon svg-18">
      </ion-button>
      <ion-button fill="clear" class="toolbar-btn" routerLink="/perfil-miski">
        <img src="assets/icon/login2.svg" alt="Adjuntar" class="avatar">
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <h1 class="page-title">Inventario</h1>

  <!-- Segmentos de categorías -->
  <div class="categories-wrapper">
    <ion-segment [(ngModel)]="selectedCategory" mode="ios" class="custom-segment" (ionChange)="onCategoryChange()">
      <ion-segment-button value="limpieza">
        <ion-label>Limpieza</ion-label>
      </ion-segment-button>
      <ion-segment-button value="absorbentes">
        <ion-label>Absorbentes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="dispensadores">
        <ion-label>Dispensadores</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Barra de búsqueda -->
  <div class="search-section">
    <ion-searchbar 
      [(ngModel)]="searchTerm" 
      placeholder="Buscar productos..."
      mode="ios"
      class="custom-searchbar"
      (ionInput)="handleSearch($event)">
    </ion-searchbar>
  </div>

  <!-- Tarjetas destacadas -->
  <div class="featured-grid">
    <ion-card class="featured-card large">
      <div class="card-content">
        <ion-icon name="cube-outline" class="featured-icon"></ion-icon>
        <h3>Total productos</h3>
        <p>{{ filteredProducts.length }} productos</p>
      </div>
    </ion-card>
    

  </div>

  <!-- Lista de productos -->
  <ion-list lines="none" class="products-list">
    <ion-item-sliding *ngFor="let producto of paginatedProducts">
      <ion-item class="product-item" button detail="false" (click)="verDetalleProducto(producto)">
        <div class="product-image-wrapper" slot="start">
          <img [src]="producto.image || 'assets/icon/Legia.svg'" [alt]="producto.name">
        </div>
        
        <ion-label class="product-info">
          <h2 class="product-name">{{ producto.name }}</h2>
          <p class="product-code">Código: {{ producto.code }}</p>
          <p class="product-description">{{ producto.description || 'Sin descripción' }}</p>
          <div class="product-meta">
            <ion-badge [color]="(producto.stock || 0) > 10 ? 'success' : (producto.stock || 0) > 0 ? 'warning' : 'danger'" class="stock-badge">
              Stock: {{ producto.stock || 0 }}
            </ion-badge>
          </div>
        </ion-label>
        
        <ion-button fill="clear" slot="end" class="options-btn">
          <ion-icon name="ellipsis-vertical" color="medium"></ion-icon>
        </ion-button>
      </ion-item>
      
      <!-- Opciones al deslizar -->
      <ion-item-options side="end">
        <ion-item-option color="primary" (click)="editarProducto(producto)">
          <ion-icon slot="start" name="create-outline"></ion-icon>
          Editar
        </ion-item-option>
        <ion-item-option color="danger" (click)="eliminarProducto(producto)">
          <ion-icon slot="start" name="trash-outline"></ion-icon>
          Eliminar
        </ion-item-option>
      </ion-item-options>

      
    </ion-item-sliding>

    <!-- Mensaje cuando no hay productos -->
    <ion-item *ngIf="paginatedProducts.length === 0" lines="none" class="empty-state">
      <ion-label class="ion-text-center">
        <ion-icon name="cube-outline" style="font-size: 64px; color: #ccc;"></ion-icon>
        <h2>No hay productos</h2>
        <p>Agrega productos para comenzar</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Paginación -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <ion-button 
      fill="clear" 
      [disabled]="currentPage === 1"
      (click)="previousPage()">
      <ion-icon slot="icon-only" name="chevron-back"></ion-icon>
    </ion-button>
    
    <div class="page-numbers">
      <ion-button 
        *ngFor="let page of visiblePages" 
        [fill]="page === currentPage ? 'solid' : 'clear'"
        [color]="page === currentPage ? 'primary' : 'medium'"
        size="small"
        [disabled]="page === '...'"
        (click)="goToPage(page)">
        {{ page }}
      </ion-button>
    </div>
    
    <ion-button 
      fill="clear" 
      [disabled]="currentPage === totalPages"
      (click)="nextPage()">
      <ion-icon slot="icon-only" name="chevron-forward"></ion-icon>
    </ion-button>
  </div>

  <!-- Botón flotante para agregar -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="primary" (click)="agregarProducto()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>